<!DOCTYPE html>
<html>
<head>
    <title>Manage Internships - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Internship Management</h1>
            <div class="space-x-4">
                <a href="/admin/dashboard" class="hover:bg-blue-700 px-3 py-2 rounded">Dashboard</a>
                <a href="/admin/users" class="hover:bg-blue-700 px-3 py-2 rounded">Manage Users</a>
                <a href="/admin/internships" class="bg-blue-700 px-3 py-2 rounded">Manage Internships</a>
                <a href="/admin/applications" class="hover:bg-blue-700 px-3 py-2 rounded">Review Applications</a>
                <a href="/profile" class="hover:bg-blue-700 px-3 py-2 rounded">Profile</a>
                <span>Welcome, {{ user.full_name }} (Admin)</span>
                <a href="/logout" class="bg-red-600 hover:bg-red-700 px-3 py-2 rounded">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto mt-8 p-4">
        <!-- Statistics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-lg font-semibold mb-2">Total Internships</h3>
                <p class="text-2xl font-bold text-blue-600">{{ internships|length }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-lg font-semibold mb-2">Total Applications</h3>
                <p class="text-2xl font-bold text-green-600">{{ stats.total_applications }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-lg font-semibold mb-2">Total Students</h3>
                <p class="text-2xl font-bold text-purple-600">{{ stats.total_students }}</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h3 class="text-lg font-semibold mb-2">Total Mentors</h3>
                <p class="text-2xl font-bold text-orange-600">{{ stats.total_mentors }}</p>
            </div>
        </div>

        <!-- Create Internship Form -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4">Create New Internship</h2>
            <form id="createForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                        <input type="text" name="title" required class="w-full p-2 border border-gray-300 rounded" placeholder="Software Development Intern">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company *</label>
                        <input type="text" name="company" required class="w-full p-2 border border-gray-300 rounded" placeholder="Tech Company Inc.">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description *</label>
                    <textarea name="description" required rows="3" class="w-full p-2 border border-gray-300 rounded" placeholder="Describe the internship role and responsibilities..."></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                        <input type="text" name="location" class="w-full p-2 border border-gray-300 rounded" placeholder="Remote, New York, etc.">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Duration</label>
                        <input type="text" name="duration" class="w-full p-2 border border-gray-300 rounded" placeholder="3 months, 6 months, etc.">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Stipend</label>
                        <input type="text" name="stipend" class="w-full p-2 border border-gray-300 rounded" placeholder="$2000/month, Unpaid, etc.">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Requirements</label>
                        <textarea name="requirements" rows="2" class="w-full p-2 border border-gray-300 rounded" placeholder="Skills and qualifications required..."></textarea>
                    </div>
                </div>
                <button type="button" onclick="createInternship()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
                    <i class="fas fa-plus mr-2"></i>Create Internship
                </button>
            </form>
        </div>

        <!-- Internships List -->
        <div class="bg-white rounded-lg shadow-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold">All Internships ({{ internships|length }})</h2>
            </div>
            <div class="p-6">
                {% if internships %}
                <div class="space-y-4">
                    {% for internship in internships %}
                    <div class="border border-gray-200 rounded-lg p-4" id="internship-{{ internship.id }}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900">{{ internship.title }}</h3>
                                <p class="text-gray-600">{{ internship.company }} â€¢ {{ internship.location or 'Remote' }}</p>
                                <p class="text-sm text-gray-500 mt-2">{{ internship.description }}</p>
                                <div class="flex items-center mt-3 space-x-4 text-sm text-gray-500">
                                    <span><i class="fas fa-clock mr-1"></i> {{ internship.duration or 'Not specified' }}</span>
                                    <span><i class="fas fa-money-bill-wave mr-1"></i> {{ internship.stipend or 'Not specified' }}</span>
                                    <span><i class="fas fa-user mr-1"></i> {{ internship.creator.full_name if internship.creator else 'Unknown' }}</span>
                                </div>
                                {% if internship.requirements %}
                                <div class="mt-2">
                                    <span class="text-sm font-medium text-gray-700">Requirements:</span>
                                    <p class="text-sm text-gray-600">{{ internship.requirements }}</p>
                                </div>
                                {% endif %}
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="editInternship('{{ internship.id }}')" 
                                    class="bg-yellow-500 text-white px-3 py-2 rounded text-sm hover:bg-yellow-600 transition">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                                <button onclick="deleteInternship('{{ internship.id }}')" 
                                    class="bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 transition">
                                    <i class="fas fa-trash mr-1"></i>Delete
                                </button>
                            </div>
                        </div>
                        
                        <!-- Edit Form (Hidden by default) -->
                        <div id="edit-form-{{ internship.id }}" class="mt-4 p-4 bg-gray-50 rounded hidden">
                            <h4 class="font-semibold mb-3 text-gray-800">Edit Internship</h4>
                            <form class="space-y-3">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <input type="text" name="title" value="{{ internship.title }}" class="p-2 border rounded" placeholder="Title" required>
                                    <input type="text" name="company" value="{{ internship.company }}" class="p-2 border rounded" placeholder="Company" required>
                                </div>
                                <textarea name="description" class="w-full p-2 border rounded" placeholder="Description" required>{{ internship.description }}</textarea>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <input type="text" name="location" value="{{ internship.location or '' }}" class="p-2 border rounded" placeholder="Location">
                                    <input type="text" name="duration" value="{{ internship.duration or '' }}" class="p-2 border rounded" placeholder="Duration">
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <input type="text" name="stipend" value="{{ internship.stipend or '' }}" class="p-2 border rounded" placeholder="Stipend">
                                    <textarea name="requirements" class="p-2 border rounded" placeholder="Requirements">{{ internship.requirements or '' }}</textarea>
                                </div>
                                <div class="flex space-x-2">
                                    <button type="button" onclick="updateInternship('{{ internship.id }}')" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition">
                                        <i class="fas fa-save mr-1"></i>Update
                                    </button>
                                    <button type="button" onclick="cancelEdit('{{ internship.id }}')" 
                                        class="bg-gray-500 text-white px-4 py-2 rounded text-sm hover:bg-gray-600 transition">
                                        <i class="fas fa-times mr-1"></i>Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <i class="fas fa-briefcase text-gray-400 text-4xl mb-4"></i>
                    <p class="text-gray-500 text-lg">No internships found.</p>
                    <p class="text-gray-400">Create your first internship using the form above.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
    // SIMPLE AND WORKING VERSION
    async function createInternship() {
        const form = document.getElementById('createForm');
        const formData = new FormData(form);
        
        try {
            const response = await fetch('/api/admin/internships', {
                method: 'POST',
                body: formData,
                credentials: 'include'
            });
            
            const result = await response.json();
            console.log("CREATE Result:", result);
            
            if (result.success) {
                alert('Internship created successfully!');
                form.reset();
                location.reload();
            } else {
                alert('Create failed: ' + result.error);
            }
        } catch (error) {
            console.error('Create error:', error);
            alert('Network error: ' + error.message);
        }
    }

    async function updateInternship(internshipId) {
        const form = document.querySelector('#edit-form-' + internshipId + ' form');
        const formData = new FormData(form);
        
        try {
            const response = await fetch('/api/admin/internships/' + internshipId, {
                method: 'PUT',
                body: formData,
                credentials: 'include'
            });
            
            const result = await response.json();
            console.log("UPDATE Result:", result);
            
            if (result.success) {
                alert('Internship updated successfully!');
                location.reload();
            } else {
                alert('Update failed: ' + result.error);
            }
        } catch (error) {
            console.error('Update error:', error);
            alert('Network error: ' + error.message);
        }
    }

    async function deleteInternship(internshipId) {
        if (!confirm('Are you sure you want to delete this internship and all applications?')) {
            return;
        }

        try {
            const response = await fetch('/api/admin/internships/' + internshipId, {
                method: 'DELETE',
                credentials: 'include'
            });
            
            const result = await response.json();
            console.log("DELETE Result:", result);
            
            if (result.success) {
                alert('Internship deleted successfully!');
                location.reload();
            } else {
                alert('Delete failed: ' + result.error);
            }
        } catch (error) {
            console.error('Delete error:', error);
            alert('Network error: ' + error.message);
        }
    }

    function editInternship(internshipId) {
        document.querySelectorAll('[id^="edit-form-"]').forEach(form => {
            form.classList.add('hidden');
        });
        document.getElementById('edit-form-' + internshipId).classList.remove('hidden');
    }

    function cancelEdit(internshipId) {
        document.getElementById('edit-form-' + internshipId).classList.add('hidden');
    }

    // Check auth status on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Admin internships page loaded');
    });
    </script>
</body>
</html>